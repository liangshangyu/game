<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <title>亲爱的，请用一笔画出图形</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no"
    />
    <link href="css/onstroke.css" rel="stylesheet" />
  </head>

  <body>
    <div class="wrapper">
      <!-- 关卡列表 -->
      <ul class="levels" id="levels">
        <!-- <li class="level">
				<span class="level-no">001</span>
				<span class="level-name">第一关</span>
				<div class="level-arrow"></div>
			</li> -->
      </ul>
      <div class="game" id="game">
        <div class="game-back" id="gameBack"></div>
        <canvas id="easel" width="375" height="603" class="easel"></canvas>
        <div class="game-control">
          <div class="game-control-reset">重新开始</div>
          <div class="game-control-rollback">回退</div>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript" src="script/lib/pixi.js"></script>
  <script type="text/javascript" src="script/lib/gsap/TweenMax.js"></script>
  <script type="text/javascript" src="script/onestroke.js"></script>
  <script type="text/javascript">
    let onestroke = new OneStroke({
      // 默认的线段颜色与端点颜色
      lineColor: 0xe2e2e2,
      vertexColor: 0x6dc6c0,
      strokeColor: 0x416275,
      activeVertexColor: 0x6dc6c0,
      levels: [
        {
          lineColor: 13422809,
          vertexColor: 4884953,
          strokeColor: 2442476.5,
          activeVertexColor: 4884953,
          lines: [
            { x1: 220, y1: 148, x2: 220, y2: 448 },
            { x1: 220, y1: 148, x2: 516, y2: 448 },
            { x1: 516, y1: 148, x2: 220, y2: 448 },
            { x1: 516, y1: 148, x2: 516, y2: 448 },
            { x1: 220, y1: 448, x2: 368, y2: 448 },
            { x1: 220, y1: 448, x2: 68, y2: 1008 },
            { x1: 368, y1: 448, x2: 516, y2: 448 },
            { x1: 368, y1: 448, x2: 68, y2: 1008 },
            { x1: 368, y1: 448, x2: 668, y2: 1008 },
            { x1: 368, y1: 672, x2: 68, y2: 1008 },
            { x1: 368, y1: 672, x2: 668, y2: 1008 },
            { x1: 368, y1: 896, x2: 68, y2: 1008 },
            { x1: 368, y1: 896, x2: 668, y2: 1008 },
            { x1: 68, y1: 1008, x2: 668, y2: 1008 },
            { x1: 516, y1: 448, x2: 668, y2: 1008 },
          ],
          name: '4-1',
        },
        {
          lineColor: 13422809,
          vertexColor: 15292222,
          strokeColor: 7646111,
          activeVertexColor: 15292222,
          lines: [
            { x1: 368, y1: 176, x2: 368, y2: 328 },
            { x1: 368, y1: 176, x2: 68, y2: 552 },
            { x1: 368, y1: 328, x2: 180, y2: 552 },
            { x1: 368, y1: 328, x2: 368, y2: 552 },
            { x1: 368, y1: 328, x2: 556, y2: 552 },
            { x1: 68, y1: 552, x2: 180, y2: 552 },
            { x1: 68, y1: 552, x2: 368, y2: 924 },
            { x1: 180, y1: 552, x2: 368, y2: 552 },
            { x1: 180, y1: 552, x2: 368, y2: 776 },
            { x1: 368, y1: 552, x2: 556, y2: 552 },
            { x1: 368, y1: 552, x2: 368, y2: 776 },
            { x1: 556, y1: 552, x2: 668, y2: 552 },
            { x1: 556, y1: 552, x2: 368, y2: 776 },
            { x1: 668, y1: 552, x2: 368, y2: 924 },
            { x1: 368, y1: 776, x2: 368, y2: 924 },
          ],
          name: '4-2',
        },
        {
          lineColor: 13422809,
          vertexColor: 15772450,
          strokeColor: 7886225,
          activeVertexColor: 15772450,
          lines: [
            { x1: 68, y1: 164, x2: 256, y2: 352 },
            { x1: 68, y1: 164, x2: 220, y2: 988 },
            { x1: 256, y1: 164, x2: 256, y2: 352 },
            { x1: 256, y1: 164, x2: 480, y2: 352 },
            { x1: 480, y1: 164, x2: 256, y2: 352 },
            { x1: 480, y1: 164, x2: 480, y2: 352 },
            { x1: 668, y1: 164, x2: 480, y2: 352 },
            { x1: 668, y1: 164, x2: 516, y2: 988 },
            { x1: 256, y1: 352, x2: 68, y2: 764 },
            { x1: 256, y1: 352, x2: 368, y2: 988 },
            { x1: 480, y1: 352, x2: 668, y2: 764 },
            { x1: 480, y1: 352, x2: 368, y2: 988 },
            { x1: 68, y1: 764, x2: 220, y2: 988 },
            { x1: 668, y1: 764, x2: 516, y2: 988 },
          ],
          name: '4-3',
        },
        {
          lineColor: 13422809,
          vertexColor: 1817755,
          strokeColor: 908877.5,
          activeVertexColor: 1817755,
          lines: [
            { x1: 108, y1: 152, x2: 368, y2: 600 },
            { x1: 108, y1: 152, x2: 256, y2: 712 },
            { x1: 632, y1: 152, x2: 368, y2: 600 },
            { x1: 632, y1: 152, x2: 480, y2: 712 },
            { x1: 368, y1: 224, x2: 68, y2: 452 },
            { x1: 368, y1: 224, x2: 668, y2: 452 },
            { x1: 68, y1: 452, x2: 108, y2: 860 },
            { x1: 668, y1: 452, x2: 632, y2: 860 },
            { x1: 368, y1: 600, x2: 256, y2: 712 },
            { x1: 368, y1: 600, x2: 480, y2: 712 },
            { x1: 256, y1: 712, x2: 108, y2: 860 },
            { x1: 256, y1: 712, x2: 368, y2: 1012 },
            { x1: 480, y1: 712, x2: 632, y2: 860 },
            { x1: 480, y1: 712, x2: 368, y2: 1012 },
          ],
          name: '4-4',
        },
        {
          lineColor: 13422809,
          vertexColor: 15292222,
          strokeColor: 7646111,
          activeVertexColor: 15292222,
          lines: [
            { x1: 68, y1: 152, x2: 368, y2: 412 },
            { x1: 68, y1: 152, x2: 180, y2: 636 },
            { x1: 668, y1: 152, x2: 368, y2: 412 },
            { x1: 668, y1: 152, x2: 556, y2: 636 },
            { x1: 220, y1: 412, x2: 368, y2: 672 },
            { x1: 220, y1: 412, x2: 368, y2: 1008 },
            { x1: 516, y1: 412, x2: 368, y2: 672 },
            { x1: 516, y1: 412, x2: 368, y2: 1008 },
            { x1: 180, y1: 636, x2: 368, y2: 672 },
            { x1: 180, y1: 636, x2: 68, y2: 896 },
            { x1: 556, y1: 636, x2: 368, y2: 672 },
            { x1: 556, y1: 636, x2: 668, y2: 896 },
            { x1: 368, y1: 672, x2: 68, y2: 896 },
            { x1: 368, y1: 672, x2: 668, y2: 896 },
          ],
          name: '4-5',
        },
        {
          lineColor: 13422809,
          vertexColor: 15292222,
          strokeColor: 7646111,
          activeVertexColor: 15292222,
          lines: [
            { x1: 68, y1: 148, x2: 144, y2: 372 },
            { x1: 68, y1: 148, x2: 368, y2: 412 },
            { x1: 368, y1: 132, x2: 368, y2: 412 },
            { x1: 668, y1: 148, x2: 592, y2: 372 },
            { x1: 668, y1: 148, x2: 368, y2: 412 },
            { x1: 144, y1: 372, x2: 368, y2: 560 },
            { x1: 144, y1: 372, x2: 368, y2: 972 },
            { x1: 592, y1: 372, x2: 368, y2: 560 },
            { x1: 592, y1: 372, x2: 368, y2: 972 },
            { x1: 368, y1: 560, x2: 108, y2: 748 },
            { x1: 368, y1: 560, x2: 632, y2: 748 },
            { x1: 108, y1: 748, x2: 368, y2: 972 },
            { x1: 632, y1: 748, x2: 368, y2: 972 },
            { x1: 368, y1: 132, x2: 144, y2: 372 },
            { x1: 368, y1: 132, x2: 592, y2: 372 },
          ],
          name: '4-6',
        },
        {
          lineColor: 13422809,
          vertexColor: 15772450,
          strokeColor: 7886225,
          activeVertexColor: 15772450,
          lines: [
            { x1: 480, y1: 152, x2: 220, y2: 300 },
            { x1: 480, y1: 152, x2: 668, y2: 300 },
            { x1: 220, y1: 300, x2: 668, y2: 300 },
            { x1: 220, y1: 300, x2: 220, y2: 600 },
            { x1: 668, y1: 300, x2: 220, y2: 600 },
            { x1: 668, y1: 300, x2: 668, y2: 600 },
            { x1: 68, y1: 600, x2: 220, y2: 600 },
            { x1: 68, y1: 600, x2: 68, y2: 900 },
            { x1: 220, y1: 600, x2: 516, y2: 600 },
            { x1: 516, y1: 600, x2: 668, y2: 600 },
            { x1: 516, y1: 600, x2: 68, y2: 900 },
            { x1: 516, y1: 600, x2: 516, y2: 900 },
            { x1: 68, y1: 900, x2: 516, y2: 900 },
            { x1: 68, y1: 900, x2: 292, y2: 976 },
            { x1: 516, y1: 900, x2: 292, y2: 976 },
          ],
          name: '4-7',
        },
        {
          lineColor: 13422809,
          vertexColor: 2600545,
          strokeColor: 1300272.5,
          activeVertexColor: 2600545,
          lines: [
            { x1: 68, y1: 160, x2: 368, y2: 160 },
            { x1: 68, y1: 160, x2: 68, y2: 572 },
            { x1: 68, y1: 160, x2: 368, y2: 572 },
            { x1: 68, y1: 160, x2: 368, y2: 1020 },
            { x1: 368, y1: 160, x2: 668, y2: 160 },
            { x1: 368, y1: 160, x2: 68, y2: 572 },
            { x1: 368, y1: 160, x2: 668, y2: 572 },
            { x1: 668, y1: 160, x2: 368, y2: 572 },
            { x1: 668, y1: 160, x2: 668, y2: 572 },
            { x1: 668, y1: 160, x2: 368, y2: 1020 },
            { x1: 68, y1: 572, x2: 68, y2: 1020 },
            { x1: 68, y1: 572, x2: 368, y2: 1020 },
            { x1: 368, y1: 572, x2: 68, y2: 1020 },
            { x1: 368, y1: 572, x2: 668, y2: 1020 },
            { x1: 668, y1: 572, x2: 368, y2: 1020 },
            { x1: 668, y1: 572, x2: 668, y2: 1020 },
          ],
          name: '4-8',
        },
        {
          lineColor: 13422809,
          vertexColor: 15292222,
          strokeColor: 7646111,
          activeVertexColor: 15292222,
          lines: [
            { x1: 180, y1: 144, x2: 68, y2: 476 },
            { x1: 556, y1: 144, x2: 668, y2: 476 },
            { x1: 556, y1: 144, x2: 68, y2: 812 },
            { x1: 68, y1: 476, x2: 668, y2: 812 },
            { x1: 668, y1: 476, x2: 68, y2: 812 },
            { x1: 68, y1: 812, x2: 68, y2: 996 },
            { x1: 68, y1: 812, x2: 256, y2: 996 },
            { x1: 256, y1: 812, x2: 68, y2: 996 },
            { x1: 256, y1: 812, x2: 480, y2: 996 },
            { x1: 480, y1: 812, x2: 256, y2: 996 },
            { x1: 480, y1: 812, x2: 668, y2: 996 },
            { x1: 668, y1: 812, x2: 480, y2: 996 },
            { x1: 668, y1: 812, x2: 668, y2: 996 },
            { x1: 180, y1: 144, x2: 668, y2: 812 },
          ],
          name: '4-9',
        },
        {
          lineColor: 13422809,
          vertexColor: 14242905,
          strokeColor: 7121452.5,
          activeVertexColor: 14242905,
          lines: [
            { x1: 372, y1: 168, x2: 220, y2: 468 },
            { x1: 372, y1: 168, x2: 520, y2: 468 },
            { x1: 144, y1: 208, x2: 220, y2: 468 },
            { x1: 144, y1: 208, x2: 520, y2: 468 },
            { x1: 596, y1: 208, x2: 220, y2: 468 },
            { x1: 596, y1: 208, x2: 520, y2: 468 },
            { x1: 72, y1: 392, x2: 220, y2: 468 },
            { x1: 72, y1: 392, x2: 256, y2: 732 },
            { x1: 672, y1: 392, x2: 520, y2: 468 },
            { x1: 672, y1: 392, x2: 484, y2: 732 },
            { x1: 220, y1: 468, x2: 484, y2: 732 },
            { x1: 220, y1: 468, x2: 72, y2: 920 },
            { x1: 520, y1: 468, x2: 256, y2: 732 },
            { x1: 520, y1: 468, x2: 672, y2: 920 },
            { x1: 72, y1: 920, x2: 672, y2: 920 },
          ],
          name: '4-10',
        },
        {
          lineColor: 13422809,
          vertexColor: 4884953,
          strokeColor: 2442476.5,
          activeVertexColor: 4884953,
          lines: [
            { x1: 368, y1: 136, x2: 68, y2: 756 },
            { x1: 368, y1: 308, x2: 292, y2: 420 },
            { x1: 368, y1: 308, x2: 444, y2: 420 },
            { x1: 292, y1: 420, x2: 180, y2: 644 },
            { x1: 444, y1: 420, x2: 556, y2: 644 },
            { x1: 180, y1: 644, x2: 556, y2: 644 },
            { x1: 180, y1: 644, x2: 68, y2: 756 },
            { x1: 180, y1: 644, x2: 368, y2: 756 },
            { x1: 180, y1: 644, x2: 68, y2: 980 },
            { x1: 556, y1: 644, x2: 368, y2: 756 },
            { x1: 556, y1: 644, x2: 668, y2: 756 },
            { x1: 556, y1: 644, x2: 668, y2: 980 },
            { x1: 368, y1: 756, x2: 68, y2: 980 },
            { x1: 368, y1: 756, x2: 668, y2: 980 },
            { x1: 368, y1: 136, x2: 668, y2: 756 },
          ],
          name: '4-11',
        },
      ],
    })

    // 兼容大屏幕适配
    function fitEaselInfo() {
      onestroke.viewLeft = document
        .querySelector('.wrapper')
        .getBoundingClientRect().left
      onestroke.ratio = 375 / Math.min(document.body.clientWidth, 540)
    }
    window.addEventListener('resize', fitEaselInfo)

    fitEaselInfo()

    // 通关
    onestroke.event.on('pass', function () {
      console.log('通关')
      // 进入下一关
      onestroke.next()
    })

    // 进入新的一关
    onestroke.event.on('start', function (curLevel) {
      gameBack.innerHTML = curLevel.name
    })

    // gameover
    onestroke.event.on('gameover', function () {
      alert('恭喜宝宝，通关了')
    })

    // 关卡加载中
    onestroke.event.on('level-loading', function () {
      console.log('关卡' + onestroke.curLevel + ' 加载中...')
    })

    onestroke.event.on('level-loaded', function () {
      console.log('关卡' + onestroke.curLevel + ' 加载成功')
    })

    // showOneStroke
    let showOneStroke = function () {
      levels.style.transform = game.style.transform = 'translate(-100%, 0)'
    }

    // hideOneStroke
    let hideOneStroke = function () {
      levels.style.transform = game.style.transform = 'translate(0, 0)'
    }

    // 进入对应的关卡
    let enter = function (index) {
      showOneStroke()
      onestroke.enter(index)
    }

    // 关卡列表初始化
    let initLevels = function () {
      let str = ''
      onestroke.config.levels.forEach(function (level, index) {
        str +=
          '<li class="level" onclick="enter(' +
          index +
          ')">\
				<span class="level-no">' +
          (index + 1) +
          '</span>\
				<span class="level-name">' +
          level.name +
          '</span>\
				<div class="level-arrow"></div>\
			</li>'
      })
      levels.innerHTML = str
      // 返回事件
      gameBack.addEventListener('click', function () {
        hideOneStroke()
      })
      // 重新开始
      document
        .querySelector('.game-control-reset')
        .addEventListener('click', function () {
          onestroke.restart()
        })
      // 回退
      document
        .querySelector('.game-control-rollback')
        .addEventListener('click', function () {
          onestroke.rollback()
        })
    }
    // 调用初始化列表
    initLevels()
  </script>
</html>
